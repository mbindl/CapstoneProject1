<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <title>Geography 777 - Project 1</title>

    <style>
      html,
      body {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }

      #viewDiv {
        float: right;
        padding: 0;
        margin: 0;
        height: 100%;
        width: 70%;
      }

      #feature-node {
        float: right;
        width: 30%;
        height: 100%;
        padding: 1em;
      }
    </style>

    <link
          rel="stylesheet"
          href="https://js.arcgis.com/4.13/esri/themes/light/main.css"
    />
    <script src="https://js.arcgis.com/4.13/"></script>

    <script>
      require([
        "esri/config",
        "esri/WebMap",
        "esri/Map",
        "esri/views/MapView",
        "esri/tasks/Geoprocessor",
        "esri/layers/TileLayer",
        "esri/layers/FeatureLayer",
        "esri/widgets/Expand",
        "esri/widgets/BasemapGallery",
        "esri/widgets/BasemapToggle",
        "esri/widgets/LayerList",
        "esri/widgets/LayerList/LayerListViewModel",
        "esri/widgets/Home",
        "esri/widgets/Legend",
        "esri/widgets/Print"
      ], function(
        esriConfig,
        WebMap,
        Map,
        MapView,
        Geoprocessor,
        TileLayer,
        FeatureLayer,
        Expand,
        BasemapGallery,
        BasemapToggle,
        LayerList,
        LayerListVM,
        Home,
        Legend,
        Print
      ) {
          {
        esriConfig.portalUrl = "https://trpa.maps.arcgis.com";
            };
        
          
        var webmap = new WebMap({
              portalItem: { // autocasts as new PortalItem()
                id: "1946a89da2e442488ef6ce969be0ecce"
              }
            });

        var view = new MapView({
              map: webmap,  // The WebMap instance created above
              container: "viewDiv",
              center: [-89.7,44.8],
              zoom: 7
            });
        
        // initialize geoprocessor task
        var gpUrl =
          "https://maps.trpa.org/server/rest/services/CancerRatesNitrateValues/GPServer/Cancer%20Rates%20and%20Nitrate%20Values";

        var gp = new Geoprocessor({
          url: gpUrl,
          outSpatialReference: {
            wkid: 102100
          }
        });
          
        var param = document.getElementById("kvalue").value;
          
        gp.submitJob(param);
          
        // Add a legend instance to the panel of a
        // ListItem in a LayerList instance
        const layerList = new LayerList({
              view: view,
              listItemCreatedFunction: function(event) {
                const item = event.item;
                if (item.layer.type != "group") {
                  // don't show legend twice
                  item.panel = {
                    content: "legend",
                    open: false
                  };
                }
              }
        });

        view.ui.add(layerList, "top-right");

      // Create collapasable button for Table of Contents
        var layerListExpand = new Expand({
            expandIconClass: "esri-icon-layers",  // see https://developers.arcgis.com/javascript/latest/guide/esri-icon-font/
            expandTooltip: "Layer List",
            view: view,
            autoCollapse: true,
            content: layerList.domNode
            });

        // add layer list button to the top right corner of the view
        view.ui.add(layerListExpand, "top-right");

        // function to create print service
        view.when(function() {
            var print = new Print({
                container: document.createElement("div"),
                view: view,
                // specify print service url
                printServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task"
        });

        // Create Print Button
        var printExpand = new Expand({
            expandIconClass: "esri-icon-printer",  // see https://developers.arcgis.com/javascript/latest/guide/esri-icon-font/
            expandTooltip: "Print",
            view: view,
            autoCollapse: true,
            content: print.domNode
            });

        // Add print widget to the top right corner of the view
        view.ui.add(printExpand, "top-right");
        });
          
        // move zoom buttons to top left
        view.ui.move("zoom", "top-left");
                
        // Createa Home Button
        var homeWidget = new Home({
            view: view
        });

        // adds the home widget to the top left corner of the MapView
        view.ui.add(homeWidget, "top-left");            

        var basemapToggle = new BasemapToggle({
            container: document.createElement("div"),
            view: view,
            nextBasemap: "hybrid"  // Allows for toggling to the "hybrid" basemap
        });

        // Create an Expand instance and set the content
        // property to the DOM node of the basemap gallery widget
        var bgExpand = new Expand({
            expandIconClass: "esri-icon-basemap",  // see https://developers.arcgis.com/javascript/latest/guide/esri-icon-font
            expandTooltip: "Toggle Basemap",
            view: view,
            content: basemapToggle.domNode
        });

        // Add the basemap gallery button
        view.ui.add(bgExpand, "bottom-left"); 

        // add a legend widget instance to the view
        // and set the style to 'card'. This is a
        // responsive style, which is good for mobile devices
        // or 'classic' for PC users
        const legend = new Expand({
            expandIconClass: "esri-icon-layer-list",  // see https://developers.arcgis.com/javascript/latest/guide/esri-icon-font
            expandTooltip: "Legend",
            content: new Legend({
                view: view,
                style: "classic" // other styles include 'card'
                }),
            view: view,
            expanded: false
        });
        view.ui.add(legend, "bottom-left");
      });

	</script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-72607582-23"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    //	  gtag('config', 'UA-72607582-23');
    </script>
  </head>
  <body>
    <div id="feature-node" class="esri-widget" style="background-color:lightgrey">
        <div>
          <h2>Cancer Rates and Nitrate Levels</h2>
            <h3>An explatory analysis.</h3>
          <p>
              High nitrate concentrations in drinking water are a health hazard. Recently a possible cancer risk in adults from nitrate (and nitrite) has emerged, but the magnitude of the risk is unknown. The Wisconsin Department of Natural Resources has collected data on cancers by cataloging the location of all cancer occurrences over a ten-year period. In addition, they assembled a database of nitrate levels in a group of test wells throughout the state.
            </p>
            <p>              
              This application allows the user to investigate the relationship between nitrate levels and cancer through spatial analysis. The first part of the application is to perform an inverse distance weighting analysis to produce a raster map of nitrate levels. Interpolating the nitrate levels using a weighted distance coeficient k in the process. There is no theory to say what the distance exponent k should be. 
            </p>
            <p>    
                Please choose a value for k that is greater than 1.        
            </p>
            <form>
              <label for="kvalue">k value:</label><br>
              <input type="text" id="kvalue" name="kvalue" value="2"><br>
              <input type="submit" value="Submit">
            </form>  
            <p> After the IDW raster of Nitrate values is created the application will autmatically aggregate the mean values of both nitrates and cancer rates to 500 square mile hexbins and run an ordinary least squares regression to determine if nitrate concentrations are related cancer occurrences.
                
            The results of the regression can be seen here mapped as the graduated color of the Residual value or obtained by clicking on a hexbin to view the attributes in a popup.
            </p>
        </div>
    </div>
    <div id="viewDiv"></div>
  </body>
</html>
